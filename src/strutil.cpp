// Copyright (c) 2019-2020 Xenios SEZC
// https://www.veriblock.org
// Distributed under the MIT software license, see the accompanying
// file COPYING or http://www.opensource.org/licenses/mit-license.php.

#include "veriblock/strutil.hpp"

#include <stdexcept>

namespace altintegration {

static const signed char p_util_hexdigit[256] = {
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
    0,  1,   2,   3,   4,   5,   6,   7,  8,  9,  -1, -1, -1, -1, -1, -1,
    -1, 0xa, 0xb, 0xc, 0xd, 0xe, 0xf, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, 0xa, 0xb, 0xc, 0xd, 0xe, 0xf, -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
    -1, -1,  -1,  -1,  -1,  -1,  -1,  -1, -1, -1, -1, -1, -1, -1, -1, -1,
};

inline signed char HexDigit(char c) {
  return p_util_hexdigit[(unsigned char)c];
}

std::vector<uint8_t> ParseHex(const char *psz) {
  // convert hex dump to vector
  std::vector<uint8_t> vch;
  while (true) {
    while (IsSpace(*psz)) psz++;
    signed char c = HexDigit(*psz++);
    if (c == (int8_t)-1) break;
    uint8_t n = (c << 4u);
    c = HexDigit(*psz++);
    if (c == (int8_t)-1) break;
    n |= c;
    vch.push_back(n);
  }
  return vch;
}

std::vector<uint8_t> ParseHex(const std::string &hex) {
  return ParseHex(hex.c_str());
}

bool IsHex(const std::string &str) {
  for (char it : str) {
    if (HexDigit(it) < 0) return false;
  }
  return (!str.empty()) && (str.size() % 2 == 0);
}

std::vector<uint8_t> toBytes(const std::string input) {
  return std::vector<uint8_t>(input.begin(), input.end());
}

}  // namespace altintegration