<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>veriblock-pop-cpp: Setup ABFI</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="main.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">veriblock-pop-cpp
   </div>
   <div id="projectbrief">C++11 Libraries for leveraging VeriBlock Proof-Of-Proof blockchain technology.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('integration_13_setup_abfi.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Setup ABFI </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md25">Overview</a></li>
<li class="level1"><a href="#autotoc_md26">Altchain BFI API</a></li>
<li class="level1"><a href="#autotoc_md27">Altchain BFI last-finalized-btc endpoint</a></li>
<li class="level1"><a href="#autotoc_md28">Configuring and Building Altchain BFI From Source.</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_docs_families_btc_integration_13_setup_abfi"></a></p>
<h1><a class="anchor" id="autotoc_md25"></a>
Overview</h1>
<p >The Altchain Bitcoin Finality Indicator (ABFI) service provides an API that returns a number indicating the security of a transaction. This number is called bitcoinFinality and is found in the returned json data.</p>
<p >You can install this service and configure it for your altchain. To get ABFI, you can download this docker image: <a href="https://hub.docker.com/r/veriblock/altchain-bfi">https://hub.docker.com/r/veriblock/altchain-bfi</a></p>
<p >Additional setup instructions are available at the docker link. If you are building ABFI from source instead of using the prebuilt docker image, then follow the instructions at the bottom of this page.</p>
<p >Once the ABFI service is running, make HTTP requests to the service through its IP address. For example, use the following URL in your browser to make a request. </p><div class="fragment"><div class="line">http://[ip_to_altchain_bfi]:4568/api/chains/blocks/last-finalized-btc</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md26"></a>
Altchain BFI API</h1>
<p >The following endpoints are accessible at the ABFI API. Modify the URL just shown to make these requests.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Endpoint   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">/api/chains   </td><td class="markdownTableBodyNone">Get the last 20 best blocks from the blockchain and any fork blocks at the same height    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">/api/chains/best   </td><td class="markdownTableBodyNone">Get the best chain information    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">/api/chains/blocks/{hash}   </td><td class="markdownTableBodyNone">Get the SI block for the given hash    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">/api/chains/blocks/best/{height}   </td><td class="markdownTableBodyNone">Get the SI best block for the given height    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">/api/chains/blocks/last-finalized   </td><td class="markdownTableBodyNone">Get the last finalized block    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">/api/chains/blocks/last-finalized-btc   </td><td class="markdownTableBodyNone">Get the last block finalized by btc   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md27"></a>
Altchain BFI last-finalized-btc endpoint</h1>
<p >In order to get responses there should be at least one APM mining at the altchain network also it could take a while (hours), here is a response example for that endpoint:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;id&quot; : &quot;B6D1B863FD54FA855B&quot;,</div>
<div class="line">  &quot;height&quot; : 11440,</div>
<div class="line">  &quot;hash&quot; : &quot;000000001E802E0F5AB2CA888290A707B131E3F1DA4A8BB6D1B863FD54FA855B&quot;,</div>
<div class="line">  &quot;previousHash&quot; : &quot;0000000AE242C1C892AEA8A3A2682F228289F75F5946530D766CA766BD7768A1&quot;,</div>
<div class="line">  &quot;previousKeystone&quot; : &quot;00000001E1A35BD73304BD632DB553613650D73C85153831C58C1B500C773E27&quot;,</div>
<div class="line">  &quot;secondKeystone&quot; : &quot;000000027A1B454934C0BFBFF7DD3F40C869882700C6D5817D571A90E9D1AF35&quot;,</div>
<div class="line">  &quot;known&quot; : true,</div>
<div class="line">  &quot;popVerified&quot; : true,</div>
<div class="line">  &quot;verifiedIn&quot; : [ {</div>
<div class="line">    &quot;height&quot; : 1576960,</div>
<div class="line">    &quot;hash&quot; : &quot;0000000E68FA6A30244E8532D01CFEBB81BAEB44D6450E28&quot;</div>
<div class="line">  } ],</div>
<div class="line">  &quot;endorsedIn&quot; : [ {</div>
<div class="line">    &quot;height&quot; : 1576960,</div>
<div class="line">    &quot;hash&quot; : &quot;0000000E68FA6A30244E8532D01CFEBB81BAEB44D6450E28&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1576966,</div>
<div class="line">    &quot;hash&quot; : &quot;0000000A6040FF891E758D33E1DE54CAA29A4F6AB84E5D30&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1576972,</div>
<div class="line">    &quot;hash&quot; : &quot;00000007480E7A9E697EF558B079B1ACDE8882C0EF1B3606&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1576980,</div>
<div class="line">    &quot;hash&quot; : &quot;0000000DF194B1596BA7D370D648C7AE16040C0D7EB9CA44&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1576982,</div>
<div class="line">    &quot;hash&quot; : &quot;0000001364EBF5245B4A675C10C17F18BE37F635F8670187&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1576983,</div>
<div class="line">    &quot;hash&quot; : &quot;0000000D7E0EC709ADFC57AF215FC889A2A1E25E28E04206&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1576994,</div>
<div class="line">    &quot;hash&quot; : &quot;000000025C294CA53B43F54FC69C585AAE4C3CD0D416AAA7&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1576996,</div>
<div class="line">    &quot;hash&quot; : &quot;000000143032BD8EFB60F1634C9A1F6AFB41E415B6A09E11&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1576998,</div>
<div class="line">    &quot;hash&quot; : &quot;000000084D8751DDE79A6ADDEBEB750E95A1CD4E43B5BC6F&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1577003,</div>
<div class="line">    &quot;hash&quot; : &quot;000000130E12451DD48F579A4A4F52AD08FAB653885C89DE&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1577004,</div>
<div class="line">    &quot;hash&quot; : &quot;0000000D7D6700CF31C70D157CE1F7F362265C6D66AA2CEA&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1577005,</div>
<div class="line">    &quot;hash&quot; : &quot;0000000AE903A898C5F2B6A81EBEB4810B1D08590BE22242&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1577006,</div>
<div class="line">    &quot;hash&quot; : &quot;000000041D9555371540E9E2C1C0EAC249F63E9FC31C0AD8&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1577007,</div>
<div class="line">    &quot;hash&quot; : &quot;00000013377AE0B4A9CB10B176844CAE7ACE051C055DAD70&quot;</div>
<div class="line">  }, {</div>
<div class="line">    &quot;height&quot; : 1577009,</div>
<div class="line">    &quot;hash&quot; : &quot;000000011253477867C52CDE9FE93BA85F2A182643B00FCA&quot;</div>
<div class="line">  } ],</div>
<div class="line">  &quot;spFinality&quot; : 629,</div>
<div class="line">  &quot;bitcoinFinality&quot; : 19,</div>
<div class="line">  &quot;isAttackInProgress&quot; : false</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28"></a>
Configuring and Building Altchain BFI From Source.</h1>
<p >The altchain BFI can be configured through the <b>application.conf</b> file which is inside the <b>bin</b> folder.</p>
<p >Configuration example: </p><div class="fragment"><div class="line">bfi {</div>
<div class="line">  altchainId = vbtc</div>
<div class="line"> </div>
<div class="line">  blockChainNetwork = testnet</div>
<div class="line"> </div>
<div class="line">  nodeCoreRpcHost = &quot;127.0.0.1:10500&quot;</div>
<div class="line"> </div>
<div class="line">  api {</div>
<div class="line">    port = 4568</div>
<div class="line">    notificationsTest = false</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  forkThreatThreshold = 2</div>
<div class="line">  forkThreatRatioThreshold = 0.8</div>
<div class="line"> </div>
<div class="line">  debugOutput = false</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">securityInheriting {</div>
<div class="line">  vbtc: {</div>
<div class="line">    payoutAddress: &quot;0x&quot;</div>
<div class="line">    pluginKey: btc</div>
<div class="line">    id: 3860170</div>
<div class="line">    name: &quot;vBitcoin&quot;</div>
<div class="line">    host: &quot;http://localhost:18332&quot;</div>
<div class="line">    auth: {</div>
<div class="line">      username: &quot;test&quot;</div>
<div class="line">      password: &quot;test&quot;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p >Alternatively you can use the following environment variables to configure the ABFI:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration name   </th><th class="markdownTableHeadNone">Environment variable   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">altchainId   </td><td class="markdownTableBodyNone">ALTCHAIN_ID   </td><td class="markdownTableBodyNone">undefined   </td><td class="markdownTableBodyNone">The altchain id, it must be configured    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">blockChainNetwork   </td><td class="markdownTableBodyNone">NETWORK   </td><td class="markdownTableBodyNone">testnet   </td><td class="markdownTableBodyNone">The altchain network, there are three options: mainnet, testnet and regtest    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">blockChainRegtestHost   </td><td class="markdownTableBodyNone">REGTEST_HOST   </td><td class="markdownTableBodyNone">undefined   </td><td class="markdownTableBodyNone">The altchain regtest host (the network should be specified as regtest)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">nodeCoreRpcHost   </td><td class="markdownTableBodyNone">NODECORE_HOST   </td><td class="markdownTableBodyNone">127.0.0.1:10500   </td><td class="markdownTableBodyNone">The NodeCore ip where the ABFI will connects to    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">notificationsTest   </td><td class="markdownTableBodyNone">HTTP_API_NOTIFICATIONS_TEST   </td><td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">Enables the /notifications-test endpoint to trigger test notifications    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">forkThreatThreshold   </td><td class="markdownTableBodyNone">FORK_THREAT_THRESHOLD   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">forkThreatRatioThreshold   </td><td class="markdownTableBodyNone">FORK_THREAT_RATIO_THRESHOLD   </td><td class="markdownTableBodyNone">0.8   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">debugOutput   </td><td class="markdownTableBodyNone">DEBUG_OUTPUT   </td><td class="markdownTableBodyNone">false   </td><td class="markdownTableBodyNone">Generate debug log files   </td></tr>
</table>
<p >You can add chains to the securityInheriting block, for example:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">payoutAddress   </td><td class="markdownTableBodyNone">This configuration should be set in order to make the ABFI work but it will be removed, set it to "0x"    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">pluginKey   </td><td class="markdownTableBodyNone">The plugin to load    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">id   </td><td class="markdownTableBodyNone">The chain id    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">name   </td><td class="markdownTableBodyNone">The chain name    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">host   </td><td class="markdownTableBodyNone">API url from the coin daemon    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">auth: username   </td><td class="markdownTableBodyNone">The username used on the daemon authentication (if any), it can be disabled by commenting the whole auth config block.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">auth: password   </td><td class="markdownTableBodyNone">The password used on the daemon authentication (if any), it can be disabled by commenting the whole auth config block.   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<script>
    $(document).ready(function(){
        $('.line').each(function(){
            var t = $(this).html()
            if(t.startsWith("+")) {
                $(this).addClass('diff-plus')
                $(this).html(t.slice(1))
                $(this).prepend(
                    $('<div>+</div>')
                        .addClass('noselect')
                        .addClass('sign')
                )
            } else if (t.startsWith("-")) {
                $(this).addClass('diff-minus')
                $(this).html(t.slice(1))
                $(this).prepend(
                    $('<div>-</div>')
                        .addClass('noselect')
                        .addClass('sign')
                )
            }
        })
    });
</script>