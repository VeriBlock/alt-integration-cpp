<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>veriblock-pop-cpp: Adding persistence</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="main.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">veriblock-pop-cpp
   </div>
   <div id="projectbrief">C++11 Libraries for leveraging VeriBlock Proof-Of-Proof blockchain technology.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('integration_5_persistence.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Adding persistence </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md52">Overview</a></li>
<li class="level1"><a href="#autotoc_md53">1. Add PayloadsProvider.</a></li>
<li class="level1"><a href="#autotoc_md54">2. Create wrappers for the persistence API.</a></li>
<li class="level1"><a href="#autotoc_md55">3. Initialize VeriBlock storage during ALT blockchain initialization process.</a></li>
<li class="level1"><a href="#autotoc_md56">4. Update the constructor of the TestingSetup struct.</a></li>
<li class="level1"><a href="#autotoc_md57">5. Restore VeriBlock block hash from the storage - do not recalculate it if possible.</a></li>
<li class="level1"><a href="#autotoc_md58">6. Add pop_service.cpp to the makefile.</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_docs_families_btc_integration_5_persistence"></a></p>
<h1><a class="anchor" id="autotoc_md52"></a>
Overview</h1>
<p>ALT block storage should be modified to store VeriBlock related data.</p>
<h1><a class="anchor" id="autotoc_md53"></a>
1. Add PayloadsProvider.</h1>
<p>We should add a <code>PayloadsProvider</code> for the VeriBlock library. The main idea of such class is that we reuse the existing ALT blockchain database. Our library allows to use the native implementation of the database. We implement it with <code>PayloadsProvider</code> class which is inherited from the <a class="el" href="structaltintegration_1_1PayloadsStorage.html" title="Accessor for ATV/VTB/VbkBlock bodies given hash.">altintegration::PayloadsStorage</a> class.</p>
<p>Payloads provider: <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/adaptors/payloads_provider.hpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/adaptors/payloads_provider.hpp</a>. Copy this file to your project.</p>
<p>Block provider: <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/adaptors/block_provider.hpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/adaptors/block_provider.hpp</a>. Copy this file to your project.</p>
<dl class="section note"><dt>Note</dt><dd>These adaptors rely heavily on Bitcoin structures such as <code>CDBWrapper</code> and <code>CDBIterator</code>. Other blockchains should use own adaptors or other means for storing VeriBlock related data.</dd></dl>
<h1><a class="anchor" id="autotoc_md54"></a>
2. Create wrappers for the persistence API.</h1>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/pop_service.hpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/pop_service.hpp</a> </p><div class="fragment"><div class="line"><span class="comment">// Copyright (c) 2019-2021 Xenios SEZC</span></div>
<div class="line"><span class="comment">// https://www.veriblock.org</span></div>
<div class="line"><span class="comment">// Distributed under the MIT software license, see the accompanying</span></div>
<div class="line"><span class="comment">// file COPYING or http://www.opensource.org/licenses/mit-license.php.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef BITCOIN_SRC_VBK_POP_SERVICE_HPP</span></div>
<div class="line"><span class="preprocessor">#define BITCOIN_SRC_VBK_POP_SERVICE_HPP</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;pop_common.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vbk/adaptors/payloads_provider.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vbk/util.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>CBlockTreeDB;</div>
<div class="line"><span class="keyword">class </span>CDBBatch;</div>
<div class="line"><span class="keyword">class </span>CDBIterator;</div>
<div class="line"><span class="keyword">class </span>CDBWrapper;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>VeriBlock {</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> InitPopContext(CDBWrapper&amp; db);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> hasPopData(CBlockTreeDB&amp; db);</div>
<div class="line"><a class="code" href="structaltintegration_1_1PopData.html">altintegration::PopData</a> getPopData();</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespacealtintegration.html#a1036e0889afa590fec23e3efc7b3c995">saveTrees</a>(CDBBatch* batch);</div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="namespacealtintegration.html#a190a292eda6248cf2cceb20ee1501a1c">loadTrees</a>(CDBWrapper&amp; db);</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace VeriBlock</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">//BITCOIN_SRC_VBK_POP_SERVICE_HPP</span></div>
<div class="ttc" id="anamespacealtintegration_html_a1036e0889afa590fec23e3efc7b3c995"><div class="ttname"><a href="namespacealtintegration.html#a1036e0889afa590fec23e3efc7b3c995">altintegration::saveTrees</a></div><div class="ttdeci">void saveTrees(const AltBlockTree &amp;tree, BlockBatch &amp;batch)</div><div class="ttdoc">Save all (BTC/VBK/ALT) trees on disk in a single Batch.</div></div>
<div class="ttc" id="anamespacealtintegration_html_a190a292eda6248cf2cceb20ee1501a1c"><div class="ttname"><a href="namespacealtintegration.html#a190a292eda6248cf2cceb20ee1501a1c">altintegration::loadTrees</a></div><div class="ttdeci">bool loadTrees(AltBlockTree &amp;tree, ValidationState &amp;state)</div><div class="ttdoc">Load all (ALT/VBK/BTC) trees from disk into memory.</div></div>
<div class="ttc" id="astructaltintegration_1_1PopData_html"><div class="ttname"><a href="structaltintegration_1_1PopData.html">altintegration::PopData</a></div><div class="ttdoc">Represents ALT block body of POP-related info.</div><div class="ttdef"><b>Definition:</b> <a href="popdata_8hpp_source.html#l00027">popdata.hpp:27</a></div></div>
</div><!-- fragment --><p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/pop_service.cpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/pop_service.cpp</a> </p><div class="fragment"><div class="line"><span class="comment">// Copyright (c) 2019-2021 Xenios SEZC</span></div>
<div class="line"><span class="comment">// https://www.veriblock.org</span></div>
<div class="line"><span class="comment">// Distributed under the MIT software license, see the accompanying</span></div>
<div class="line"><span class="comment">// file COPYING or http://www.opensource.org/licenses/mit-license.php.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;chain.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;chainparams.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;consensus/validation.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;dbwrapper.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;shutdown.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;validation.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vbk/adaptors/payloads_provider.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;veriblock/storage/util.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef WIN32</span></div>
<div class="line"><span class="preprocessor">#include &lt;boost/thread/interruption.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">//WIN32</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;pop_service.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vbk/adaptors/block_provider.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vbk/pop_common.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>VeriBlock {</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> InitPopContext(CDBWrapper&amp; db)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> payloads_provider = std::make_shared&lt;PayloadsProvider&gt;(db);</div>
<div class="line">    SetPop(payloads_provider);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> hasPopData(CBlockTreeDB&amp; db)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> db.Exists(tip_key&lt;altintegration::BtcBlock&gt;()) &amp;&amp;</div>
<div class="line">           db.Exists(tip_key&lt;altintegration::VbkBlock&gt;()) &amp;&amp;</div>
<div class="line">           db.Exists(tip_key&lt;altintegration::AltBlock&gt;());</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespacealtintegration.html#a1036e0889afa590fec23e3efc7b3c995">saveTrees</a>(CDBBatch* batch)</div>
<div class="line">{</div>
<div class="line">    AssertLockHeld(cs_main);</div>
<div class="line">    VeriBlock::BlockBatch b(*batch);</div>
<div class="line">    altintegration::SaveAllTrees(*GetPop().altTree, b);</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="namespacealtintegration.html#a190a292eda6248cf2cceb20ee1501a1c">loadTrees</a>(CDBWrapper&amp; db)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classaltintegration_1_1ValidationState.html">altintegration::ValidationState</a> state;</div>
<div class="line"> </div>
<div class="line">    BlockReader reader(db);</div>
<div class="line">    <span class="keywordflow">if</span> (!altintegration::LoadAllTrees(GetPop(), reader, state)) {</div>
<div class="line">        <span class="keywordflow">return</span> error(<span class="stringliteral">&quot;%s: failed to load trees %s&quot;</span>, __func__, state.toString());</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassaltintegration_1_1ValidationState_html"><div class="ttname"><a href="classaltintegration_1_1ValidationState.html">altintegration::ValidationState</a></div><div class="ttdoc">Class that is used for storing validation state.</div><div class="ttdef"><b>Definition:</b> <a href="validation__state_8hpp_source.html#l00028">validation_state.hpp:28</a></div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>You can copy provided <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/pop_service.hpp">pop_service.hpp</a> and <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/pop_service.cpp">pop_service.cpp</a> files and comment out everything but storage related API.</dd></dl>
<h1><a class="anchor" id="autotoc_md55"></a>
3. Initialize VeriBlock storage during ALT blockchain initialization process.</h1>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/init.cpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/init.cpp</a> </p><div class="fragment"><div class="line">+#include &lt;vbk/pop_service.hpp&gt;</div>
</div><!-- fragment --><p> <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/init.cpp#L177">method Shutdown</a> </p><div class="fragment"><div class="line">     threadGroup.interrupt_all();</div>
<div class="line">     threadGroup.join_all();</div>
<div class="line">+    VeriBlock::StopPop();</div>
</div><!-- fragment --><p> <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/init.cpp#L1209">method AppInitMain</a> </p><div class="fragment"><div class="line">                 pblocktree.reset();</div>
<div class="line">                 pblocktree.reset(<span class="keyword">new</span> CBlockTreeDB(nBlockTreeDBCache, <span class="keyword">false</span>, fReset));</div>
<div class="line">+                VeriBlock::InitPopContext(*pblocktree);</div>
</div><!-- fragment --><p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/txdb.cpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/txdb.cpp</a> </p><div class="fragment"><div class="line"><span class="preprocessor"> #include &lt;boost/thread.hpp&gt;</span></div>
<div class="line">+#include &lt;vbk/pop_service.hpp&gt;</div>
</div><!-- fragment --><p> <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/txdb.cpp#L226">method CBlockTreeDB::WriteBatchSync</a> </p><div class="fragment"><div class="line">     }</div>
<div class="line">+</div>
<div class="line">+    <span class="comment">// write BTC/VBK/ALT blocks</span></div>
<div class="line">+    VeriBlock::saveTrees(&amp;batch);</div>
<div class="line">     <span class="keywordflow">return</span> WriteBatch(batch, <span class="keyword">true</span>);</div>
</div><!-- fragment --><p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/validation.cpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/validation.cpp</a> </p><div class="fragment"><div class="line"><span class="preprocessor"> #include &lt;warnings.h&gt;</span></div>
<div class="line"> </div>
<div class="line">+#include &lt;vbk/pop_service.hpp&gt;</div>
<div class="line">+#include &lt;vbk/pop_common.hpp&gt;</div>
<div class="line">+#include &lt;vbk/util.hpp&gt;</div>
</div><!-- fragment --><p> <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/validation.cpp#L4177">method BlockManager::LoadBlockIndex</a> </p><div class="fragment"><div class="line">         <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">+    <span class="keywordtype">bool</span> hasPopData = VeriBlock::hasPopData(blocktree);</div>
<div class="line">+</div>
<div class="line">+    <span class="keywordflow">if</span> (!hasPopData) {</div>
<div class="line">+        LogPrintf(<span class="stringliteral">&quot;BTC/VBK/ALT tips not found... skipping block index loading\n&quot;</span>);</div>
<div class="line">+        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">+    }</div>
<div class="line">+</div>
<div class="line">     <span class="comment">// Calculate nChainWork</span></div>
</div><!-- fragment --><p> <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/validation.cpp#L4177">method BlockManager::LoadBlockIndex</a> </p><div class="fragment"><div class="line">         <span class="keywordflow">if</span> (pindex-&gt;IsValid(BLOCK_VALID_TREE) &amp;&amp; (pindexBestHeader == <span class="keyword">nullptr</span> || CBlockIndexWorkComparator()(pindexBestHeader, pindex)))</div>
<div class="line">             pindexBestHeader = pindex;</div>
<div class="line">     }</div>
<div class="line">+</div>
<div class="line">+    <span class="comment">// get best chain from ALT tree and update vBTC&#39;s best chain</span></div>
<div class="line">+    {</div>
<div class="line">+        AssertLockHeld(cs_main);</div>
<div class="line">+</div>
<div class="line">+        <span class="comment">// load blocks</span></div>
<div class="line">+        <span class="keywordflow">if</span>(!VeriBlock::loadTrees(blocktree)) {</div>
<div class="line">+            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">+        }</div>
<div class="line">     }</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md56"></a>
4. Update the constructor of the TestingSetup struct.</h1>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/test/util/setup_common.cpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/test/util/setup_common.cpp</a></p>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/test/util/setup_common.cpp#L102">method TestingSetup::TestingSetup</a> </p><div class="fragment"><div class="line">     pblocktree.reset(<span class="keyword">new</span> CBlockTreeDB(1 &lt;&lt; 20, <span class="keyword">true</span>));</div>
<div class="line">+    VeriBlock::InitPopContext(*pblocktree);</div>
</div><!-- fragment --><p> <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/test/util/setup_common.cpp#L146">method TestingSetup::~TestingSetup</a> </p><div class="fragment"><div class="line">     threadGroup.interrupt_all();</div>
<div class="line">     threadGroup.join_all();</div>
<div class="line">+    VeriBlock::StopPop();</div>
</div><!-- fragment --><p> <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/test/util/setup_common.cpp#L162">method TestChain100Setup::TestChain100Setup</a> </p><div class="fragment"><div class="line">+    assert(ChainActive().Tip() != <span class="keyword">nullptr</span>);</div>
<div class="line">+    assert(ChainActive().Tip()-&gt;nHeight == 100);</div>
<div class="line">+    assert(BlockIndex().size() == 101);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md57"></a>
5. Restore VeriBlock block hash from the storage - do not recalculate it if possible.</h1>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/dbwrapper.h">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/dbwrapper.h</a> </p><div class="fragment"><div class="line">+<span class="comment">// VeriBlock: put VBK block hash in the block index</span></div>
<div class="line">+<span class="keyword">template</span> &lt;&gt;</div>
<div class="line">+<span class="keyword">inline</span> <span class="keywordtype">bool</span> CDBIterator::GetValue(<a class="code" href="structaltintegration_1_1BlockIndex.html">altintegration::BlockIndex&lt;altintegration::VbkBlock&gt;</a>&amp; value)</div>
<div class="line">+{</div>
<div class="line">+    leveldb::Slice slValue = piter-&gt;value();</div>
<div class="line">+    <span class="keywordflow">try</span> {</div>
<div class="line">+        CDataStream ssValue(slValue.data(), slValue.data() + slValue.size(), SER_DISK, CLIENT_VERSION);</div>
<div class="line">+        ssValue.Xor(dbwrapper_private::GetObfuscateKey(parent));</div>
<div class="line">+        std::pair&lt;char, altintegration::VbkBlock::hash_t&gt; key;</div>
<div class="line">+        <span class="keywordflow">if</span> (!GetKey(key)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">+        UnserializeWithHash(ssValue, value, key.second);</div>
<div class="line">+    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp;) {</div>
<div class="line">+        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">+    }</div>
<div class="line">+    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">+}</div>
<div class="ttc" id="astructaltintegration_1_1BlockIndex_html"><div class="ttname"><a href="structaltintegration_1_1BlockIndex.html">altintegration::BlockIndex</a></div><div class="ttdoc">A node in a block tree.</div><div class="ttdef"><b>Definition:</b> <a href="block__index_8hpp_source.html#l00031">block_index.hpp:31</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md58"></a>
6. Add pop_service.cpp to the makefile.</h1>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/Makefile.am">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/Makefile.am</a> </p><div class="fragment"><div class="line"> libbitcoin_server_a_SOURCES = \</div>
<div class="line">+  vbk/pop_service.hpp \</div>
<div class="line">+  vbk/pop_service.cpp \
   addrdb.cpp \</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<script>
    $(document).ready(function(){
        $('.line').each(function(){
            var t = $(this).html()
            if(t.startsWith("+")) {
                $(this).addClass('diff-plus')
                $(this).html(t.slice(1))
                $(this).prepend(
                    $('<div>+</div>')
                        .addClass('noselect')
                        .addClass('sign')
                )
            } else if (t.startsWith("-")) {
                $(this).addClass('diff-minus')
                $(this).html(t.slice(1))
                $(this).prepend(
                    $('<div>-</div>')
                        .addClass('noselect')
                        .addClass('sign')
                )
            }
        })
    });
</script>