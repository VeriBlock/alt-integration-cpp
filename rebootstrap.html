<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>veriblock-pop-cpp: How to rebootstrap BTC and VBK blockchains</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="main.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">veriblock-pop-cpp
   </div>
   <div id="projectbrief">C++11 Libraries for leveraging VeriBlock Proof-Of-Proof blockchain technology.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('rebootstrap.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How to rebootstrap BTC and VBK blockchains </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_docs_rebootstrap"></a> </p>
<h3><a class="anchor" id="autotoc_md104"></a>
Legend</h3>
<ul>
<li>VBK - VeriBlock</li>
<li>BTC - Bitcoin</li>
<li>Finalized - blocks that have 100% chance of being final, e.g. which will never reorganize. For BTC it is same to assume that all blocks behind 11 blocks from current tip are final. For VBK, 2000.</li>
</ul>
<h3><a class="anchor" id="autotoc_md105"></a>
Description</h3>
<p >Rebootstrapping is a process of changing bootstrap blocks stored in altchain.</p>
<dl class="section note"><dt>Note</dt><dd>Example from vBTC: <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/bootstraps.cpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/bootstraps.cpp</a></dd></dl>
<p>To properly validate every ATV and VTB, Altchain should maintain a SPV view on BTC and VBK blockchains. Every blockchain starts with a genesis block - a single hand-crafted block, which is a "root" of a tree.</p>
<p >Similarly, VBK and BTC blockchains should start with a root block. Since we don't start at block 0, we should specify at least 1 <code>difficulty adjustment interval</code> worth of contiguous blocks, otherwise we won't be able to statefully validate their difficulty. For BTC we require at least 2016 blocks, and for VBK we require at least 100 blocks.</p>
<h3><a class="anchor" id="autotoc_md106"></a>
Protocol</h3>
<dl class="section warning"><dt>Warning</dt><dd>For Altchain <code>mainnet</code> you ALWAYS should use VBK <code>mainnet</code> and BTC <code>mainnet</code>, otherwise there will be serious security issues. </dd>
<dd>
For Altchain Testnet, use VBK <code>testnet</code> and BTC <code>testnet</code>. </dd>
<dd>
For automated testing/<code>regtest</code>, use VBK <code>regtest_progpow</code> and BTC <code>regtest</code>.</dd></dl>
<ol type="1">
<li>Fetch 2016 finalized <b>contiguous</b> BTC headers, and save height of first header.<ul>
<li>Find <code>btcStartHeight</code>: if last BTC block height is 1M, then use heights <code>1M - F - 2016</code> where <code>F</code> is number of confirmations to consider block final, and <code>2016</code> is the number of blocks in single BTC difficulty adjustment interval. In our example <code>btcStartHeight=1M-11-2016=997973</code></li>
<li>Find hash of block on <code>btcStartHeight</code>, for example <code>000000000d9fcff7c03867d8d6331506cb9ed885be4b098d9df1ec6c552b54f9</code></li>
<li>Use <code>getblockheader &lt;hash&gt;</code> RPC to get actual block header content. Serialized block header is always 80 bytes.</li>
</ul>
</li>
<li>Fetch 100 finalized <b>contiguous</b> VBK headers, and save height of first header.</li>
<li>Hardcode <code>btcStartHeight</code>, <code>btcHeaders</code>, <code>vbkStartHeight</code>, <code>vbkHeaders</code> in <code>bootstraps.cpp</code>: <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/bootstraps.cpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/vbk/bootstraps.cpp</a></li>
</ol>
<dl class="section warning"><dt>Warning</dt><dd>ALL peers MUST have identical bootstrap blocks, otherwise they will fork, therefore we hardcode them in Altchain daemon. Similarly to having different genesis blocks of the same coin. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<script>
    $(document).ready(function(){
        $('.line').each(function(){
            var t = $(this).html()
            if(t.startsWith("+")) {
                $(this).addClass('diff-plus')
                $(this).html(t.slice(1))
                $(this).prepend(
                    $('<div>+</div>')
                        .addClass('noselect')
                        .addClass('sign')
                )
            } else if (t.startsWith("-")) {
                $(this).addClass('diff-minus')
                $(this).html(t.slice(1))
                $(this).prepend(
                    $('<div>-</div>')
                        .addClass('noselect')
                        .addClass('sign')
                )
            }
        })
    });
</script>
