// Copyright (c) 2019-2022 Xenios SEZC
// https://www.veriblock.org
// Distributed under the MIT software license, see the accompanying
// file LICENSE or http://www.opensource.org/licenses/mit-license.php.

#include <gtest/gtest.h>

#include <veriblock/pop/crypto/progpow.hpp>
#include <veriblock/pop/uint.hpp>

using namespace altintegration;

struct TestCase {
  uint32_t a, b, r, result;
};

// clang-format off
static std::vector<TestCase> cases = {
    {919647165, 1235826650, 970480574, 1519412023},
    {235848472, 2067636504, 9740459, 463446528},
    {96124753, 398352178, 1397363235, 1386278083},
    {1502617003, 521724301, 927394199, 396919014},
    {146079317, 928047093, 1734502868, 2209254141},
    {1848786415, 1947702061, 1460313904, 1829332122},
    {717415688, 1793623529, 1382514629, 2413866795},
    {1536184406, 1228022174, 1478919491, 1727048392},
    {267490745, 1664847586, 1624202550, 1902107579},
    {708787813, 1192102089, 91121438, 3107263438},
    {1181726850, 1818456256, 1014592313, 2608019469},
    {2083905965, 261938005, 1966456337, 2686084960},
    {1219834757, 1761603909, 1046956302, 3361445226},
    {1653453492, 1877989054, 1997267594, 607379442},
    {361461613, 1988116066, 1911550057, 2815985940},
    {1665564793, 565873081, 1060921043, 2726117824},
    {849106522, 125344813, 2025287588, 784202126},
    {1567573087, 2120764407, 1194680099, 2213086376},
    {2029912958, 68359768, 1321815992, 3827626455},
    {566644608, 601381022, 633403125, 2751045329},
    {561201114, 1372276000, 1943285824, 3458618777},
    {1746609778, 687485126, 709536669, 870073006},
    {551070316, 81770274, 2052302021, 854928426},
    {27200037, 494261493, 1940743592, 267721584},
    {374019451, 1765121183, 889102455, 1867499108},
    {770898949, 1623245723, 1885450961, 3607835535},
    {642417005, 111115139, 571631625, 2928257511},
    {1081979336, 763790965, 952230461, 1603705113},
    {2010283092, 1581304727, 1622698489, 1954226857},
    {6935875, 327272652, 1284132251, 2431373167},
    {1794345567, 980532085, 1393820098, 64393652},
    {1746762130, 1434486129, 1141556049, 1929466600},
    {777558969, 806607251, 279124403, 3887302506},
    {905724063, 478913571, 657399751, 1484028988},
    {767154941, 1992414528, 538429348, 3760011326},
    {199087470, 482222203, 1926121523, 65181621},
    {1367389975, 162154324, 890912434, 2336350539},
    {424669146, 1166868392, 1470709614, 2296048322},
    {1776791103, 1831163803, 114945896, 2259324386},
    {1160122403, 318905795, 100974170, 4243206726},
    {416024275, 1937048372, 1268118797, 1081391090},
    {1866392082, 436176341, 2101878884, 3317549106},
    {1513601818, 1836653347, 1052366462, 245905789},
    {352279989, 403363578, 1997740346, 3438668623},
    {920886515, 1488850110, 726904387, 974100973},
    {317773446, 598411618, 652026195, 1557650532},
    {1004298510, 1169892647, 1954684179, 1263520073},
    {1664420301, 1804916461, 1129139379, 484295456},
    {1361077671, 614992587, 1930870294, 2580882770},
    {1814523050, 1943156071, 1434867091, 513839981},
    {306632771, 81541222, 195735034, 1610488073},
    {1437311160, 1939325666, 1009908230, 2125953690},
    {1376830280, 2003207567, 730836488, 1457526059},
    {186251541, 1490672753, 306006821, 3381226990},
    {1994603708, 1803952129, 428759835, 3389568093},
    {1157376396, 369437835, 151045432, 663597838},
    {1356857853, 1104921461, 1502100083, 951325576},
    {2046373804, 1740122948, 1818365924, 2043044015},
    {2115212768, 1232097603, 178459166, 2314642211},
    {402424868, 1611668617, 665077119, 1971301965},
    {769347732, 259058750, 223702892, 1303206199},
    {1555716632, 1051086033, 324989984, 1280255152},
    {1267152486, 386451768, 305359117, 198266902},
    {995390402, 2024518728, 976443807, 3287857354},
    {1680595774, 1360786114, 522657495, 3677710716},
    {56248115, 929462330, 1474123381, 251552488},
    {2037723750, 960790794, 638399426, 3781165104},
    {1701926207, 1413998785, 1752584167, 1477344702},
    {607862786, 636299416, 12708784, 667489240},
    {2128974936, 946895868, 2062298465, 3593027195},
    {1935788090, 194339381, 1496073176, 1246165307},
    {1513237398, 718321160, 1399402367, 2369147230},
    {2091075158, 1499792484, 2103690161, 4199430709},
    {490939844, 2078170355, 65905842, 1099316023},
    {2013376516, 1726277186, 751709571, 4220526342},
    {547341131, 1250223355, 1633395254, 2132611494},
    {498842165, 822314494, 617970409, 1609369785},
    {1742930960, 1147720831, 659443436, 619370627},
    {1068976095, 1973082891, 736640693, 1264789169},
    {1533485932, 2114672785, 1253999908, 307249074},
    {1222116542, 173391216, 483003804, 3528524600},
    {568982256, 2109225845, 1985469166, 3705771109},
    {1291198000, 1833936190, 1432908615, 1492196558},
    {1118064279, 2121709773, 1412727536, 2533528201},
    {966466287, 1367003704, 990688156, 3771998625},
    {1843371211, 1546952109, 174777001, 2274075707},
    {1012660111, 1855475677, 577545972, 2835767846},
    {450721972, 542751239, 1795563985, 4029861861},
    {1980588703, 2055076123, 645412659, 2592345092},
    {245591994, 1327103653, 928181250, 841704863},
    {61222426, 517123983, 2026639059, 3422860341},
    {1753257843, 7925363, 1502798847, 2282199296},
    {223374699, 628336785, 119594606, 3704734556},
    {138509435, 445934375, 404324595, 1836581596},
    {162278133, 1423997657, 1194563868, 1203253043},
    {752213425, 1533150087, 489489724, 3895817539},
    {553706801, 1626299797, 207609215, 2145832228},
    {1557454896, 651822942, 345397047, 3152794926},
    {1046090924, 938889702, 1759667242, 1100151826},
    {1063740050, 578123134, 1353641332, 1802159823},
};
// clang-format on

class ProgPowMergeTest : public testing::TestWithParam<TestCase> {};

TEST_P(ProgPowMergeTest, Regression) {
  using altintegration::progpow::merge;
  auto [a, b, r, result] = GetParam();
  auto actual = merge(a, b, r);
  ASSERT_EQ(actual, result);
}

INSTANTIATE_TEST_SUITE_P(ProgPowMergeRegression,
                         ProgPowMergeTest,
                         testing::ValuesIn(cases));
