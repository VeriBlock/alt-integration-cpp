// Copyright (c) 2019-2020 Xenios SEZC
// https://www.veriblock.org
// Distributed under the MIT software license, see the accompanying
// file LICENSE or http://www.opensource.org/licenses/mit-license.php.
#include <gtest/gtest.h>

#include <veriblock/crypto/progpow/ethash.hpp>
#include <veriblock/serde.hpp>
#include <veriblock/uint.hpp>

using namespace altintegration;

struct TestCase {
  uint64_t blockNumber;
  std::string seed;
};

// clang-format off
static std::vector<TestCase> cases = {
    {0, "7a831fdda62b056b2e2ce6ba23cc5189a4176d84c96cd196b5c8573252271cac"},
    {1277020848, "81696b54f85e38bf87bc96d438fc4fc84d8ca861e616e9b6d430acd3955b8c98"},
    {1649010076, "32f7dff0f24ad516816dd85cc951a48c86de19f25769a4f2eb72620d5fcd5f6a"},
    {478014636, "43274b5aefddc4b3dc655068b44352927586326efc50c11c7f960708832e9d5e"},
    {1299112197, "23b11b73ffc6710fc0d627374159edabc7cb062412b16c3496e6c9774fc7be99"},
    {798803469, "468c2f8909ab98431ab33bb5c72c4b08eb576f2e28554abae20324ad1daa1394"},
    {250000653, "87dd507e7d0db8e74f59a30919a2dfc806875cfdc6a57fbb2330316db61cd960"},
    {1584656129, "f5b04a4749a9c95c6d6070fc49c7d5b352d51be50e147b38db6d5d81c3bf4e2d"},
    {390125720, "b7a651fa8508525d8b2fa0f1a1c0020d7cc7c3a044b3bb5c5aee8dc322caca47"},
    {656005840, "bf3f06ca9e49d2e3562076f224ce9858c04a8c9b04a6c1581b1e5c00a02a4897"},
    {2098905917, "644ccafced5254cf42696f8ac4a45cd8d4d66cdd827eee6b8e28c35c8385aee5"},
    {684761041, "55075531c9e1f61bc55ddb43622e8f811e2010ba51578ccc5d50fca5cbeb9e12"},
    {71786398, "14ac45ec159943f11806baec0ea65de1467b5c82d302b86c28b442ec94bf8f92"},
    {1677407559, "6841ee0e53b229837f91d1ffe022d85fec022b0b5674001f5fd6f3a24a9ed23d"},
    {474299695, "a64f8f2347838aec80ac78f42da436b8a00b762113f6ccd31d6033de8dc91ba1"},
    {703826206, "80cbe43e1f003aafc123d46d71d044985bf35e4b10f27166028226cc4640ad1b"},
    {2030927044, "3b053b52463d06a30048a68b9b8e33a515fcb3494d6d2f47272ddaf6a0a4911a"},
    {717199778, "d7c786d4943c61030b72bc492c3fa6430db1709778ca495f4fb6d686abb0c99e"},
    {1348613216, "ca20b9e6b380f49b1d682d58ea56905c954a11af12018dd55d383d3a31ecba5e"},
    {102489061, "4a2ee380171ea541518681f97432528354f2b85072bce97915f53fc90dd88ff3"},
    {801673074, "c78d7d05af468ec2c6bfaabacddcd1e0b50dfc9648ba54ec5a57d48086a19acb"},
    {1559535512, "22092f477af40c3957e2c33c16dec5edeb7939f02f2983b3fb14806fed9989c8"},
    {1512311349, "4595a1f0ae66ecd9f3c7fc7ecd9e85878c0fba4c5591248d52ffe72c085f378b"},
    {696940801, "a5185c65308ef941ba43f8b6a55f6fa093896beb13adcbf967058355f70d2b76"},
    {1782748435, "c194d79ca5ebd72dd72b45d37733ffed70571ed5e8547b562b63cbb0082ede14"},
    {709071931, "40b64cc429055bbeba808e8bc885c85a4804d0e7e51455adf36e432ce8806b3c"},
    {178408378, "52b82f8a6d86c84c568330ebea2b3c31a493ff0480b022ca2688fa0c231de891"},
    {809738056, "91aac067c6453fd1cab003fc07599bc5537a042689a78aa2a308b9e6870c991c"},
    {1897372107, "4b2e114e7f58755aae420ddcc3764bed91a92f8480383f7130011a50720a40a3"},
    {1905315539, "4aa6081df4d70571d96f49b700410758e16594d27a031f02f76ef252ab8bfdbf"},
    {238777013, "3ff642c1ab70e355416209a98d7e7f5cceba374824da78b5cdf36f13af29b387"},
    {1676725828, "941d9ee4e0d7d81aeb18ed68b681ffb74520ecb5a2e6692154cb6b83823ae5e7"},
    {1462580637, "6e83a1c9dc888ebf94c9b30b9f5e4ffbe565a82a16298f5fcb0936f87afc4c27"},
    {1196582789, "31b1151382dbb43dc6d55d9234e7a8c91cfea688096d1f84cb11ac8d09e08711"},
    {405255186, "e250951c3441b8a1c89169890fa310d253732fc9514872ca1b8963977a51a4ca"},
    {1893402007, "05014a245e36e462e8d199d17e39f6ea58d8dddb6b42a9a966f84e77add888b3"},
    {1171838096, "6700e1faa4078e7cdac353c5b09e24c27572e398fd1a6f75a9115b81074e61a1"},
    {500883056, "dc2b2bca1d721028f10b3b427608cff89ebc32d03505a840d4d63de62016d9e9"},
    {352817437, "c9a02971c24636a7149aac407fc3ddd95cca84506627b4ffa40d3aeff11bfe56"},
    {1292946544, "37e613ced33888c1e362f393d387d3246650e0e9295331fb70068a910a6a9670"},
    {1975696130, "f32b2282deb6c0a7d6d93a54d789898d7a93eb468b33129a94d3ebeeeae1a3fa"},
    {620970791, "b5dcf265c001ecf62c38d72f7144c4f668aa86f87952a8a105e126d4a3ff5acd"},
    {1976552672, "fc037b760504ef38a1fd45ce137f945addff10fe3fc88440e576e10acd03a86b"},
    {599928209, "afca52a64cef3b0e86b9183914e029e1751d374c7017cf28e253065c397db025"},
    {512925430, "4022e753560167a43eb27d8de94b5b4b4ad2b30fe570d10e985dc51b661e2492"},
    {157068166, "77cfbb0c5b65b666dac01a014409197a466f0059841280321949827d19ba266b"},
    {1031366011, "3fe56967dc39fc808321c8796a84402cb538ba9a2bb613c79a464ed5852798c2"},
    {923913183, "427702db4f06d27beca2a55c6b58ff0f3ed745e0ce1936abeaf80927c091d10d"},
    {1696336223, "61b9be80d404ecd6c47053ede39ce47087c440173bcbd41f8a7b4f8b9891104e"},
    {66644293, "0c8a456826789830522d4ae64388d15abe9e4fcb027ae97f9937dd4616a6d74d"},
    {842433423, "ce073880b9c10677f5660948b4f1780f1cbf45fe78a6a187ded1ad41672acd00"}
};
// clang-format on

class EthashDagSeedTest : public testing::TestWithParam<TestCase> {};

using namespace altintegration;

TEST_P(EthashDagSeedTest, Regression) {
  auto [blockNumber, expected] = GetParam();
  auto actual = progpow::ethash_get_seedhash(blockNumber);
  auto actualhex = HexStr(actual.b, actual.b + 32);
  ASSERT_EQ(actualhex, expected);
}

INSTANTIATE_TEST_SUITE_P(EthashDagSeedRegression,
                         EthashDagSeedTest,
                         testing::ValuesIn(cases));
