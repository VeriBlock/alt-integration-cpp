<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>veriblock-pop-cpp: Adding PopData</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="main.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">veriblock-pop-cpp
   </div>
   <div id="projectbrief">C++11 Libraries for leveraging VeriBlock Proof-Of-Proof blockchain technology.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('integration_2_popdata.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Adding PopData </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md32">Overview</a></li>
<li class="level1"><a href="#autotoc_md33">1. Helper for the block hash serialization.</a></li>
<li class="level1"><a href="#autotoc_md34">2. Define POP_BLOCK_VERSION_BIT flag.</a></li>
<li class="level1"><a href="#autotoc_md35">3. Add new PopData field into the BlockTransactions, CBlockHeaderAndShortTxIDs, PartiallyDownloadedBlock and update their serialization/deserialization.</a></li>
<li class="level1"><a href="#autotoc_md36">4. Update PartiallyDownloadedBlock initializing - set PopData field.</a></li>
<li class="level1"><a href="#autotoc_md37">5. Update setting up the PopData fields during the net processing.</a></li>
<li class="level1"><a href="#autotoc_md38">6. Update validation rules.</a></li>
<li class="level1"><a href="#autotoc_md39">7. Update the mining code to setup POP_BLOCK_VERSION_BIT if VeriBlock PopData is contained in the block.</a></li>
<li class="level1"><a href="#autotoc_md40">8. Overload serialization operations for the VeriBlock PopData and other VeriBlock entities.</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_docs_families_btc_integration_2_popdata"></a></p>
<h1><a class="anchor" id="autotoc_md32"></a>
Overview</h1>
<p>We will add:</p><ol type="1">
<li><a class="el" href="structaltintegration_1_1PopData.html" title="Represents ALT block body of POP-related info.">altintegration::PopData</a> entity into the <code>CBlock</code> class in <code>primitives/block.h</code> file. This is needed to store POP-related consensus information, such as ATVs, VTBs, and VBk blocks.</li>
<li><code>POP_BLOCK_VERSION_BIT</code> flag - to distinguish if <code>CBlockHeader</code> has <a class="el" href="structaltintegration_1_1PopData.html" title="Represents ALT block body of POP-related info.">altintegration::PopData</a> or not.</li>
<li>Update serialization for <code>CBlock</code> to include <a class="el" href="structaltintegration_1_1PopData.html" title="Represents ALT block body of POP-related info.">altintegration::PopData</a>.</li>
<li>Add serialization/deserialization code for <a class="el" href="structaltintegration_1_1PopData.html" title="Represents ALT block body of POP-related info.">altintegration::PopData</a> entity.</li>
</ol>
<h1><a class="anchor" id="autotoc_md33"></a>
1. Helper for the block hash serialization.</h1>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/uint256.h">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/uint256.h</a></p>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/uint256.h#L20">class base_blob</a> </p><div class="fragment"><div class="line">     {</div>
<div class="line">         s.read((<span class="keywordtype">char</span>*)data, <span class="keyword">sizeof</span>(data));</div>
<div class="line">     }</div>
<div class="line">+</div>
<div class="line">+    <span class="comment">// helper to build std::vector from uint256</span></div>
<div class="line">+    std::vector&lt;uint8_t&gt; asVector()<span class="keyword"> const </span>{</div>
<div class="line">+        <span class="keywordflow">return</span> std::vector&lt;uint8_t&gt;{begin(), end()};</div>
<div class="line">+    }</div>
<div class="line"> };</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md34"></a>
2. Define POP_BLOCK_VERSION_BIT flag.</h1>
<p>This flag is set in a block header version and will tell users if given block header contains PopData or not.</p>
<p>In file <code>src/version.h</code> define this flag:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> PROTOCOL_VERSION = 80000;</div>
<div class="line"> </div>
<div class="line">+<span class="keyword">namespace </span>VeriBlock {</div>
<div class="line">+<span class="keyword">static</span> <span class="keyword">const</span> int32_t POP_BLOCK_VERSION_BIT = 0x80000UL;</div>
<div class="line">+}</div>
</div><!-- fragment --><p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/primitives/block.h">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/primitives/block.h</a> </p><div class="fragment"><div class="line"><span class="preprocessor"> #include &lt;serialize.h&gt;</span></div>
<div class="line"><span class="preprocessor"> #include &lt;uint256.h&gt;</span></div>
<div class="line">+#include &lt;version.h&gt;</div>
<div class="line">+#include &lt;veriblock/pop.hpp&gt;</div>
</div><!-- fragment --><p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/primitives/block.h#L75">class CBlock</a> </p><div class="fragment"><div class="line"><span class="keyword">public</span>:</div>
<div class="line">     <span class="comment">// network and disk</span></div>
<div class="line">     std::vector&lt;CTransactionRef&gt; vtx;</div>
<div class="line">+    <span class="comment">// VeriBlock  data network and disk</span></div>
<div class="line">+    <a class="code" href="structaltintegration_1_1PopData.html">altintegration::PopData</a> popData;</div>
<div class="ttc" id="astructaltintegration_1_1PopData_html"><div class="ttname"><a href="structaltintegration_1_1PopData.html">altintegration::PopData</a></div><div class="ttdoc">Represents ALT block body of POP-related info.</div><div class="ttdef"><b>Definition:</b> <a href="popdata_8hpp_source.html#l00027">popdata.hpp:27</a></div></div>
</div><!-- fragment --> <div class="fragment"><div class="line">     <span class="comment">// memory only</span></div>
<div class="line">     <span class="keyword">mutable</span> <span class="keywordtype">bool</span> fChecked;</div>
<div class="line">     <span class="keyword">inline</span> <span class="keywordtype">void</span> SerializationOp(Stream&amp; s, Operation ser_action) {</div>
<div class="line">         READWRITEAS(CBlockHeader, *<span class="keyword">this</span>);</div>
<div class="line">         READWRITE(vtx);</div>
<div class="line">+        <span class="comment">// if bit is set, then add popData to serialization of a block body</span></div>
<div class="line">+        <span class="keywordflow">if</span> (this-&gt;nVersion &amp; VeriBlock::POP_BLOCK_VERSION_BIT) {</div>
<div class="line">+            READWRITE(popData);</div>
<div class="line">+        }</div>
<div class="line">     }</div>
<div class="line"> </div>
<div class="line">     <span class="keywordtype">void</span> SetNull()</div>
<div class="line">     {</div>
<div class="line">         CBlockHeader::SetNull();</div>
<div class="line">         vtx.clear();</div>
<div class="line">+        popData.clear();</div>
<div class="line">         fChecked = <span class="keyword">false</span>;</div>
<div class="line">     }</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md35"></a>
3. Add new PopData field into the BlockTransactions, CBlockHeaderAndShortTxIDs, PartiallyDownloadedBlock and update their serialization/deserialization.</h1>
<p>Bitcoin uses these classes during sync protocol. We must ensure that <a class="el" href="structaltintegration_1_1PopData.html" title="Represents ALT block body of POP-related info.">altintegration::PopData</a> is propagated alongside transactions during sync.</p>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/blockencodings.h">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/blockencodings.h</a></p>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/blockencodings.h#L70">class BlockTransactions</a> </p><div class="fragment"><div class="line"><span class="keyword">class </span>BlockTransactions {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// A BlockTransactions message</span></div>
<div class="line">    <a class="code" href="namespacealtintegration.html#ab81c8673ad312417b7517390cb0915f6">uint256</a> blockhash;</div>
<div class="line">    std::vector&lt;CTransactionRef&gt; txn;</div>
<div class="line">+   <a class="code" href="structaltintegration_1_1PopData.html">altintegration::PopData</a> popData;</div>
<div class="ttc" id="anamespacealtintegration_html_ab81c8673ad312417b7517390cb0915f6"><div class="ttname"><a href="namespacealtintegration.html#ab81c8673ad312417b7517390cb0915f6">altintegration::uint256</a></div><div class="ttdeci">Blob&lt; SHA256_HASH_SIZE &gt; uint256</div><div class="ttdoc">This is an overloaded member function, provided for convenience. It differs from the above function o...</div><div class="ttdef"><b>Definition:</b> <a href="uint_8hpp_source.html#l00017">uint.hpp:17</a></div></div>
</div><!-- fragment --> <div class="fragment"><div class="line">             <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; txn.size(); i++)</div>
<div class="line">                 READWRITE(TransactionCompressor(txn[i]));</div>
<div class="line">         }</div>
<div class="line">+</div>
<div class="line">+        <span class="comment">// add popData to serialization</span></div>
<div class="line">+        READWRITE(popData);</div>
<div class="line">     }</div>
</div><!-- fragment --><p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/blockencodings.h#L134">class CBlockHeaderAndShortTxIDs</a> </p><div class="fragment"><div class="line"><span class="keyword">public</span>:</div>
<div class="line">     CBlockHeader header;</div>
<div class="line">+    <a class="code" href="structaltintegration_1_1PopData.html">altintegration::PopData</a> popData;</div>
</div><!-- fragment --> <div class="fragment"><div class="line">             }</div>
<div class="line">         }</div>
<div class="line"> </div>
<div class="line">+        <span class="keywordflow">if</span> (this-&gt;header.nVersion &amp; VeriBlock::POP_BLOCK_VERSION_BIT) {</div>
<div class="line">+            READWRITE(popData);</div>
<div class="line">+        }</div>
<div class="line"> </div>
<div class="line">         READWRITE(prefilledtxn);</div>
</div><!-- fragment --><p> <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/blockencodings.h#L206">class PartiallyDownloadedBlock</a> </p><div class="fragment"><div class="line"> <span class="keyword">public</span>:</div>
<div class="line">     CBlockHeader header;</div>
<div class="line">+    <a class="code" href="structaltintegration_1_1PopData.html">altintegration::PopData</a> popData;</div>
<div class="line"> </div>
<div class="line">     <span class="keyword">explicit</span> PartiallyDownloadedBlock(CTxMemPool* poolIn) : pool(poolIn) {}</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// extra_txn is a list of extra transactions to look at, in &lt;witness hash, reference&gt; form</span></div>
<div class="line">     ReadStatus InitData(<span class="keyword">const</span> CBlockHeaderAndShortTxIDs&amp; cmpctblock, <span class="keyword">const</span> std::vector&lt;std::pair&lt;uint256, CTransactionRef&gt;&gt;&amp; extra_txn);</div>
<div class="line">     <span class="keywordtype">bool</span> IsTxAvailable(<span class="keywordtype">size_t</span> index) <span class="keyword">const</span>;</div>
<div class="line">     ReadStatus FillBlock(CBlock&amp; block, <span class="keyword">const</span> std::vector&lt;CTransactionRef&gt;&amp; vtx_missing);</div>
<div class="line">+    ReadStatus FillBlock(CBlock&amp; block, <span class="keyword">const</span> std::vector&lt;CTransactionRef&gt;&amp; vtx_missing, <span class="keyword">const</span> <a class="code" href="structaltintegration_1_1PopData.html">altintegration::PopData</a>&amp; popData) {</div>
<div class="line">+        block.popData = popData;</div>
<div class="line">+        <span class="keywordflow">return</span> FillBlock(block, vtx_missing);</div>
<div class="line">+    }</div>
<div class="line"> };</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md36"></a>
4. Update PartiallyDownloadedBlock initializing - set PopData field.</h1>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/blockencodings.cpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/blockencodings.cpp</a></p>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/blockencodings.cpp#L21">method CBlockHeaderAndShortTxIDs::CBlockHeaderAndShortTxIDs</a> </p><div class="fragment"><div class="line">         <span class="keyword">const</span> CTransaction&amp; tx = *block.vtx[i];</div>
<div class="line">         shorttxids[i - 1] = GetShortID(fUseWTXID ? tx.GetWitnessHash() : tx.GetHash());</div>
<div class="line">     }</div>
<div class="line">+    <span class="comment">// don&#39;t forget to set popData</span></div>
<div class="line">+    this-&gt;popData = block.popData;</div>
</div><!-- fragment --><p> <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/blockencodings.cpp#L53">method PartiallyDownloadedBlock::InitData</a> </p><div class="fragment"><div class="line">    <span class="keywordflow">if</span> (mempool_count == shorttxids.size())</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">+   <span class="comment">// VeriBlock: set pop data</span></div>
<div class="line">+   this-&gt;popData = cmpctblock.popData;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> READ_STATUS_OK;</div>
</div><!-- fragment --><p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/blockencodings.cpp#L190">method PartiallyDownloadedBlock::FillBlock</a> </p><div class="fragment"><div class="line">     <span class="keywordflow">if</span> (vtx_missing.size() != tx_missing_offset)</div>
<div class="line">         <span class="keywordflow">return</span> READ_STATUS_INVALID;</div>
<div class="line"> </div>
<div class="line">+    <span class="comment">// VeriBlock: set popData before CheckBlock</span></div>
<div class="line">+    block.popData = this-&gt;popData;</div>
<div class="line">+</div>
<div class="line">     BlockValidationState state;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md37"></a>
5. Update setting up the PopData fields during the net processing.</h1>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/net_processing.cpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/net_processing.cpp</a></p>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/net_processing.cpp#L1655">method SendBlockTransactions</a> </p><div class="fragment"><div class="line">     <span class="keyword">const</span> CNetMsgMaker msgMaker(pfrom-&gt;GetSendVersion());</div>
<div class="line">     <span class="keywordtype">int</span> nSendFlags = State(pfrom-&gt;GetId())-&gt;fWantsCmpctWitness ? 0 : SERIALIZE_TRANSACTION_NO_WITNESS;</div>
<div class="line">+</div>
<div class="line">+    <span class="comment">//VeriBlock add popData</span></div>
<div class="line">+    resp.popData = block.popData;</div>
<div class="line">+</div>
<div class="line">     connman-&gt;PushMessage(pfrom, msgMaker.Make(nSendFlags, NetMsgType::BLOCKTXN, resp));</div>
</div><!-- fragment --><p> <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/net_processing.cpp#L1919">method ProcessMessage</a> </p><div class="fragment"><div class="line">                     BlockTransactions txn;</div>
<div class="line">                     txn.blockhash = cmpctblock.header.GetHash();</div>
<div class="line">+                    txn.popData = cmpctblock.popData;</div>
<div class="line">                     blockTxnMsg &lt;&lt; txn;</div>
<div class="line">                     fProcessBLOCKTXN = <span class="keyword">true</span>;</div>
</div><!-- fragment --> <div class="fragment"><div class="line">                 <span class="keywordflow">if</span> (status == READ_STATUS_OK) {</div>
<div class="line">                     fBlockReconstructed = <span class="keyword">true</span>;</div>
<div class="line">+                    <span class="keywordflow">if</span>(pblock &amp;&amp; pblock-&gt;nVersion &amp; VeriBlock::POP_BLOCK_VERSION_BIT) {</div>
<div class="line">+                        assert(!pblock-&gt;popData.empty() &amp;&amp; <span class="stringliteral">&quot;POP bit is set and POP data is empty&quot;</span>);</div>
<div class="line">+                    }</div>
<div class="line">                 }</div>
</div><!-- fragment --> <div class="fragment"><div class="line">             PartiallyDownloadedBlock&amp; partialBlock = *it-&gt;second.second-&gt;partialBlock;</div>
<div class="line">-            ReadStatus status = partialBlock.FillBlock(*pblock, resp.txn);</div>
<div class="line">+            ReadStatus status = partialBlock.FillBlock(*pblock, resp.txn, resp.popData);</div>
<div class="line">             <span class="keywordflow">if</span> (status == READ_STATUS_INVALID) {</div>
</div><!-- fragment --> <div class="fragment"><div class="line">          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n = 0; n &lt; nCount; n++) {</div>
<div class="line">             vRecv &gt;&gt; headers[n];</div>
<div class="line">             ReadCompactSize(vRecv); <span class="comment">// ignore tx count; assume it is 0.</span></div>
<div class="line">+            <span class="keywordflow">if</span> (headers[n].nVersion &amp; VeriBlock::POP_BLOCK_VERSION_BIT) {</div>
<div class="line">+                <a class="code" href="structaltintegration_1_1PopData.html">altintegration::PopData</a> tmp;</div>
<div class="line">+                vRecv &gt;&gt; tmp;</div>
<div class="line">+            }</div>
<div class="line">          }</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md38"></a>
6. Update validation rules.</h1>
<p>Add check that if block contains VeriBlock PopData then <code>block.nVersion</code> must contain <code>POP_BLOCK_VERSION_BIT</code>. Otherwise <code>block.nVersion</code> should not contain <code>POP_BLOCK_VERSION_BIT</code>.</p>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/validation.cpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/validation.cpp</a></p>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/validation.cpp#L2360">method UpdateTip</a> </p><div class="fragment"><div class="line">             int32_t nExpectedVersion = ComputeBlockVersion(pindex-&gt;pprev, chainParams.GetConsensus());</div>
<div class="line">-            <span class="keywordflow">if</span> (pindex-&gt;nVersion &gt; VERSIONBITS_LAST_OLD_BLOCK_VERSION &amp;&amp; (pindex-&gt;nVersion &amp; ~nExpectedVersion) != 0)</div>
<div class="line">+            <span class="comment">// do not expect this flag to be set</span></div>
<div class="line">+            <span class="keyword">auto</span> version = pindex-&gt;nVersion &amp; (~VeriBlock::POP_BLOCK_VERSION_BIT);</div>
<div class="line">+            <span class="keywordflow">if</span> (pindex-&gt;nVersion &gt; VERSIONBITS_LAST_OLD_BLOCK_VERSION &amp;&amp; (version &amp; ~nExpectedVersion) != 0)</div>
<div class="line">                 ++nUpgraded;</div>
<div class="line">             pindex = pindex-&gt;pprev;</div>
</div><!-- fragment --><p>Update <code>CheckBlock</code>:</p><ul>
<li>merkle root verification with POP depends on current state, so this validation has been migrated to <code>ContextuallyCheckBlock</code>.</li>
<li>if POP_BLOCK_VERSION_BIT is set, then PopData MUST exist and be non-empty.</li>
</ul>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/validation.cpp#L3376">method CheckBlock</a> </p><div class="fragment"><div class="line">     <span class="comment">// Check that the header is valid (particularly PoW).  This is mostly</span></div>
<div class="line">     <span class="comment">// redundant with the call in AcceptBlockHeader.</span></div>
<div class="line">     <span class="keywordflow">if</span> (!CheckBlockHeader(block, state, consensusParams, fCheckPOW))</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">-    <span class="comment">// Check the merkle root.</span></div>
<div class="line">-    <span class="keywordflow">if</span> (fCheckMerkleRoot) {</div>
<div class="line">-        <span class="keywordtype">bool</span> mutated;</div>
<div class="line">-        <a class="code" href="namespacealtintegration.html#ab81c8673ad312417b7517390cb0915f6">uint256</a> hashMerkleRoot2 = BlockMerkleRoot(block, &amp;mutated);</div>
<div class="line">-        <span class="keywordflow">if</span> (block.hashMerkleRoot != hashMerkleRoot2)</div>
<div class="line">-            <span class="keywordflow">return</span> state.Invalid(BlockValidationResult::BLOCK_MUTATED, <span class="stringliteral">&quot;bad-txnmrklroot&quot;</span>, <span class="stringliteral">&quot;hashMerkleRoot mismatch&quot;</span>);</div>
<div class="line">-</div>
<div class="line">-        <span class="comment">// Check for merkle tree malleability (CVE-2012-2459): repeating sequences</span></div>
<div class="line">-        <span class="comment">// of transactions in a block without affecting the merkle root of a block,</span></div>
<div class="line">-        <span class="comment">// while still invalidating it.</span></div>
<div class="line">-        <span class="keywordflow">if</span> (mutated)</div>
<div class="line">-            <span class="keywordflow">return</span> state.Invalid(BlockValidationResult::BLOCK_MUTATED, <span class="stringliteral">&quot;bad-txns-duplicate&quot;</span>, <span class="stringliteral">&quot;duplicate transaction&quot;</span>);</div>
<div class="line">-    }</div>
<div class="line"> </div>
<div class="line">+    <span class="comment">// VeriBlock: merkle root verification currently depends on a context, so it has been moved to ContextualCheckBlock</span></div>
<div class="line">+    <span class="keywordflow">if</span> ((block.nVersion &amp; VeriBlock::POP_BLOCK_VERSION_BIT) &amp;&amp; block.popData.empty()) {</div>
<div class="line">+       <span class="keywordflow">return</span> state.Invalid(BlockValidationResult::BLOCK_CONSENSUS, <span class="stringliteral">&quot;bad-block-pop-version&quot;</span>, <span class="stringliteral">&quot;POP bit is set, but pop data is empty&quot;</span>);</div>
<div class="line">+    }</div>
<div class="line">+    <span class="keywordflow">if</span> (!(block.nVersion &amp; VeriBlock::POP_BLOCK_VERSION_BIT) &amp;&amp; !block.popData.empty()) {</div>
<div class="line">+       <span class="keywordflow">return</span> state.Invalid(BlockValidationResult::BLOCK_CONSENSUS, <span class="stringliteral">&quot;bad-block-pop-version&quot;</span>, <span class="stringliteral">&quot;POP bit is NOT set, and pop data is NOT empty&quot;</span>);</div>
<div class="line">+    }</div>
<div class="line"> </div>
<div class="line">     <span class="comment">// All potential-corruption validation must be done before we do any</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md39"></a>
7. Update the mining code to setup POP_BLOCK_VERSION_BIT if VeriBlock PopData is contained in the block.</h1>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/miner.cpp">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/miner.cpp</a></p>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/miner.cpp#L96">method BlockAssembler::CreateNewBlock</a> </p><div class="fragment"><div class="line">   addPackageTxs&lt;ancestor_score&gt;(nPackagesSelected, nDescendantsUpdated);</div>
<div class="line"> </div>
<div class="line">+  <span class="comment">// VeriBlock: add PopData into the block</span></div>
<div class="line">+  <span class="keywordflow">if</span> (chainparams.isPopActive(nHeight))</div>
<div class="line">+  {</div>
<div class="line">+      pblock-&gt;popData = VeriBlock::getPopData(*pindexPrev);</div>
<div class="line">+  }</div>
<div class="line">+</div>
<div class="line">+  <span class="keywordflow">if</span> (!pblock-&gt;popData.empty()) {</div>
<div class="line">+      pblock-&gt;nVersion |= VeriBlock::POP_BLOCK_VERSION_BIT;</div>
<div class="line">+  }</div>
<div class="line">+</div>
<div class="line">   int64_t nTime1 = GetTimeMicros();</div>
<div class="line"> </div>
<div class="line">   m_last_block_num_txs = nBlockTx;</div>
<div class="line">   m_last_block_weight = nBlockWeight;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md40"></a>
8. Overload serialization operations for the VeriBlock PopData and other VeriBlock entities.</h1>
<dl class="section warning"><dt>Warning</dt><dd>In our example we use VeriBlock-native serialization (function <code>toVbkEncoding</code>). It essentially couples Altchain CBlock serialization to VBK encoding. If VBK encoding ever change, Altchain will get hard fork. To mitigate this, it is stongly suggested to implement your own serialization.</dd></dl>
<p>During deserialization, if any of internal entities can not be deserialized, throw an exception.</p>
<p><a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/serialize.h">https://github.com/VeriBlock/vbk-ri-btc/blob/master/src/serialize.h</a></p>
<div class="fragment"><div class="line"><span class="preprocessor"> #include &lt;prevector.h&gt;</span></div>
<div class="line"><span class="preprocessor"> #include &lt;span.h&gt;</span></div>
<div class="line"> </div>
<div class="line">+#include &lt;veriblock/pop.hpp&gt;</div>
<div class="line">+</div>
<div class="line"> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> MAX_SIZE = 0x02000000;</div>
</div><!-- fragment --><div class="fragment"><div class="line">+<span class="comment">// VeriBlock: Serialize a PopData object</span></div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Serialize(Stream&amp; s, <span class="keyword">const</span> <a class="code" href="structaltintegration_1_1PopData.html">altintegration::PopData</a>&amp; pop_data) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data = pop_data.<a class="code" href="structaltintegration_1_1PopData.html#a261845c9bd353abd9c70a6208e08c57b">toVbkEncoding</a>();</div>
<div class="line">+    Serialize(s, bytes_data);</div>
<div class="line">+}</div>
<div class="line"> </div>
<div class="line">+<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">+<span class="keywordtype">void</span> UnserializeOrThrow(<span class="keyword">const</span> std::vector&lt;uint8_t&gt;&amp; in, T&amp; out) {</div>
<div class="line">+    <a class="code" href="classaltintegration_1_1ValidationState.html">altintegration::ValidationState</a> state;</div>
<div class="line">+    <a class="code" href="structaltintegration_1_1ReadStream.html">altintegration::ReadStream</a> stream(in);</div>
<div class="line">+    <span class="keywordflow">if</span>(!<a class="code" href="namespacealtintegration.html#a88b8b3c0c6658d96fe684ffad67e2476">altintegration::DeserializeFromVbkEncoding</a>(stream, out, state)) {</div>
<div class="line">+        <span class="keywordflow">throw</span> std::invalid_argument(state.toString());</div>
<div class="line">+    }</div>
<div class="line">+}</div>
<div class="line">+</div>
<div class="line">+<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line">+<span class="keywordtype">void</span> UnserializeOrThrow(<span class="keyword">const</span> std::vector&lt;uint8_t&gt;&amp; in, T&amp; out, <span class="keyword">typename</span> T::hash_t precalculatedHash) {</div>
<div class="line">+    <a class="code" href="classaltintegration_1_1ValidationState.html">altintegration::ValidationState</a> state;</div>
<div class="line">+    <a class="code" href="structaltintegration_1_1ReadStream.html">altintegration::ReadStream</a> stream(in);</div>
<div class="line">+    <span class="keywordflow">if</span>(!<a class="code" href="namespacealtintegration.html#a88b8b3c0c6658d96fe684ffad67e2476">altintegration::DeserializeFromVbkEncoding</a>(stream, out, state, precalculatedHash)) {</div>
<div class="line">+        <span class="keywordflow">throw</span> std::invalid_argument(state.toString());</div>
<div class="line">+    }</div>
<div class="line">+}</div>
<div class="line">+</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Unserialize(Stream&amp; s, <a class="code" href="structaltintegration_1_1PopData.html">altintegration::PopData</a>&amp; pop_data) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data;</div>
<div class="line">+    Unserialize(s, bytes_data);</div>
<div class="line">+    UnserializeOrThrow(bytes_data, pop_data);</div>
<div class="line">+}</div>
<div class="line">+</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Serialize(Stream&amp; s, <span class="keyword">const</span> <a class="code" href="structaltintegration_1_1ATV.html">altintegration::ATV</a>&amp; atv) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data = atv.<a class="code" href="structaltintegration_1_1ATV.html#a5c09170c6abae48ec131ec4cff670754">toVbkEncoding</a>();</div>
<div class="line">+    Serialize(s, bytes_data);</div>
<div class="line">+}</div>
<div class="line">+</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Unserialize(Stream&amp; s, <a class="code" href="structaltintegration_1_1ATV.html">altintegration::ATV</a>&amp; atv) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data;</div>
<div class="line">+    Unserialize(s, bytes_data);</div>
<div class="line">+    UnserializeOrThrow(bytes_data, atv);</div>
<div class="line">+}</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Serialize(Stream&amp; s, <span class="keyword">const</span> <a class="code" href="structaltintegration_1_1VTB.html">altintegration::VTB</a>&amp; vtb) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data = vtb.<a class="code" href="structaltintegration_1_1VTB.html#a3d01efdef24e1705cfa0041cba456813">toVbkEncoding</a>();</div>
<div class="line">+    Serialize(s, bytes_data);</div>
<div class="line">+}</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Unserialize(Stream&amp; s, <a class="code" href="structaltintegration_1_1VTB.html">altintegration::VTB</a>&amp; vtb) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data;</div>
<div class="line">+    Unserialize(s, bytes_data);</div>
<div class="line">+    UnserializeOrThrow(bytes_data, vtb);</div>
<div class="line">+}</div>
<div class="line">+</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Serialize(Stream&amp; s, <span class="keyword">const</span> <a class="code" href="structaltintegration_1_1BlockIndex.html">altintegration::BlockIndex&lt;altintegration::BtcBlock&gt;</a>&amp; b) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data = b.toVbkEncoding();</div>
<div class="line">+    Serialize(s, bytes_data);</div>
<div class="line">+}</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Unserialize(Stream&amp; s, <a class="code" href="structaltintegration_1_1BlockIndex.html">altintegration::BlockIndex&lt;altintegration::BtcBlock&gt;</a>&amp; b) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data;</div>
<div class="line">+    Unserialize(s, bytes_data);</div>
<div class="line">+    UnserializeOrThrow(bytes_data, b);</div>
<div class="line">+}</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Serialize(Stream&amp; s, <span class="keyword">const</span> <a class="code" href="structaltintegration_1_1BlockIndex.html">altintegration::BlockIndex&lt;altintegration::VbkBlock&gt;</a>&amp; b) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data = b.toVbkEncoding();</div>
<div class="line">+    Serialize(s, bytes_data);</div>
<div class="line">+}</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Unserialize(Stream&amp; s, <a class="code" href="structaltintegration_1_1BlockIndex.html">altintegration::BlockIndex&lt;altintegration::VbkBlock&gt;</a>&amp; b) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data;</div>
<div class="line">+    Unserialize(s, bytes_data);</div>
<div class="line">+    UnserializeOrThrow(bytes_data, b);</div>
<div class="line">+}</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Serialize(Stream&amp; s, <span class="keyword">const</span> <a class="code" href="structaltintegration_1_1BlockIndex.html">altintegration::BlockIndex&lt;altintegration::AltBlock&gt;</a>&amp; b) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data = b.toVbkEncoding();</div>
<div class="line">+    Serialize(s, bytes_data);</div>
<div class="line">+}</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Unserialize(Stream&amp; s, <a class="code" href="structaltintegration_1_1BlockIndex.html">altintegration::BlockIndex&lt;altintegration::AltBlock&gt;</a>&amp; b) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data;</div>
<div class="line">+    Unserialize(s, bytes_data);</div>
<div class="line">+    UnserializeOrThrow(bytes_data, b);</div>
<div class="line">+}</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream, <span class="keywordtype">size_t</span> N&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Serialize(Stream&amp; s, <span class="keyword">const</span> <a class="code" href="structaltintegration_1_1Blob.html">altintegration::Blob&lt;N&gt;</a>&amp; b) {</div>
<div class="line">+    Serialize(s, b.asVector());</div>
<div class="line">+}</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream, <span class="keywordtype">size_t</span> N&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Unserialize(Stream&amp; s, <a class="code" href="structaltintegration_1_1Blob.html">altintegration::Blob&lt;N&gt;</a>&amp; b) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes;</div>
<div class="line">+    Unserialize(s, bytes);</div>
<div class="line">+    <span class="keywordflow">if</span>(bytes.size() &gt; N) {</div>
<div class="line">+        <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Blob: bad size. Expected &lt;= &quot;</span> + std::to_string(N) + <span class="stringliteral">&quot;, got=&quot;</span> + std::to_string(bytes.size()));</div>
<div class="line">+    }</div>
<div class="line">+    b = bytes;</div>
<div class="line">+}</div>
<div class="line">+</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Serialize(Stream&amp; s, <span class="keyword">const</span> <a class="code" href="structaltintegration_1_1VbkBlock.html">altintegration::VbkBlock</a>&amp; block) {</div>
<div class="line">+    <a class="code" href="classaltintegration_1_1WriteStream.html">altintegration::WriteStream</a> stream;</div>
<div class="line">+    block.<a class="code" href="structaltintegration_1_1VbkBlock.html#aa85426e112fc48c153616e3b0a79f009">toVbkEncoding</a>(stream);</div>
<div class="line">+    Serialize(s, stream.data());</div>
<div class="line">+}</div>
<div class="line">+<span class="keyword">template</span>&lt;<span class="keyword">typename</span> Stream&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> Unserialize(Stream&amp; s, <a class="code" href="structaltintegration_1_1VbkBlock.html">altintegration::VbkBlock</a>&amp; block) {</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data;</div>
<div class="line">+    Unserialize(s, bytes_data);</div>
<div class="line">+    UnserializeOrThrow(bytes_data, block);</div>
<div class="line">+}</div>
<div class="line">+<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Stream&gt;</div>
<div class="line">+<span class="keyword">inline</span> <span class="keywordtype">void</span> UnserializeWithHash(Stream&amp; s, <a class="code" href="structaltintegration_1_1BlockIndex.html">altintegration::BlockIndex&lt;altintegration::VbkBlock&gt;</a>&amp; block, <span class="keyword">const</span> <a class="code" href="structaltintegration_1_1Blob.html">altintegration::VbkBlock::hash_t</a>&amp; precalculatedHash = <a class="code" href="structaltintegration_1_1Blob.html">altintegration::VbkBlock::hash_t</a>())</div>
<div class="line">+{</div>
<div class="line">+    std::vector&lt;uint8_t&gt; bytes_data;</div>
<div class="line">+    Unserialize(s, bytes_data);</div>
<div class="line">+    UnserializeOrThrow(bytes_data, block, precalculatedHash);</div>
<div class="line">+}</div>
<div class="ttc" id="aclassaltintegration_1_1ValidationState_html"><div class="ttname"><a href="classaltintegration_1_1ValidationState.html">altintegration::ValidationState</a></div><div class="ttdoc">Class that is used for storing validation state.</div><div class="ttdef"><b>Definition:</b> <a href="validation__state_8hpp_source.html#l00028">validation_state.hpp:28</a></div></div>
<div class="ttc" id="aclassaltintegration_1_1WriteStream_html"><div class="ttname"><a href="classaltintegration_1_1WriteStream.html">altintegration::WriteStream</a></div><div class="ttdoc">Binary writer that is useful for binary serialization.</div><div class="ttdef"><b>Definition:</b> <a href="write__stream_8hpp_source.html#l00020">write_stream.hpp:20</a></div></div>
<div class="ttc" id="anamespacealtintegration_html_a88b8b3c0c6658d96fe684ffad67e2476"><div class="ttname"><a href="namespacealtintegration.html#a88b8b3c0c6658d96fe684ffad67e2476">altintegration::DeserializeFromVbkEncoding</a></div><div class="ttdeci">bool DeserializeFromVbkEncoding(ReadStream &amp;stream, AltBlockAddon &amp;out, ValidationState &amp;state)</div><div class="ttdoc">This is an overloaded member function, provided for convenience. It differs from the above function o...</div></div>
<div class="ttc" id="astructaltintegration_1_1ATV_html"><div class="ttname"><a href="structaltintegration_1_1ATV.html">altintegration::ATV</a></div><div class="ttdoc">Atlchain endorsement.</div><div class="ttdef"><b>Definition:</b> <a href="atv_8hpp_source.html#l00028">atv.hpp:28</a></div></div>
<div class="ttc" id="astructaltintegration_1_1ATV_html_a5c09170c6abae48ec131ec4cff670754"><div class="ttname"><a href="structaltintegration_1_1ATV.html#a5c09170c6abae48ec131ec4cff670754">altintegration::ATV::toVbkEncoding</a></div><div class="ttdeci">void toVbkEncoding(WriteStream &amp;stream) const</div><div class="ttdoc">Convert ATV to data stream using Vbk byte format.</div></div>
<div class="ttc" id="astructaltintegration_1_1Blob_html"><div class="ttname"><a href="structaltintegration_1_1Blob.html">altintegration::Blob</a></div><div class="ttdoc">Contiguous byte array of fixed size.</div><div class="ttdef"><b>Definition:</b> <a href="blob_8hpp_source.html#l00026">blob.hpp:26</a></div></div>
<div class="ttc" id="astructaltintegration_1_1BlockIndex_html"><div class="ttname"><a href="structaltintegration_1_1BlockIndex.html">altintegration::BlockIndex</a></div><div class="ttdoc">A node in a block tree.</div><div class="ttdef"><b>Definition:</b> <a href="block__index_8hpp_source.html#l00031">block_index.hpp:31</a></div></div>
<div class="ttc" id="astructaltintegration_1_1PopData_html_a261845c9bd353abd9c70a6208e08c57b"><div class="ttname"><a href="structaltintegration_1_1PopData.html#a261845c9bd353abd9c70a6208e08c57b">altintegration::PopData::toVbkEncoding</a></div><div class="ttdeci">void toVbkEncoding(WriteStream &amp;stream) const</div><div class="ttdoc">Convert PopData to data stream using Vbk byte format.</div></div>
<div class="ttc" id="astructaltintegration_1_1ReadStream_html"><div class="ttname"><a href="structaltintegration_1_1ReadStream.html">altintegration::ReadStream</a></div><div class="ttdoc">Binary reading stream, that is useful during binary deserialization.</div><div class="ttdef"><b>Definition:</b> <a href="read__stream_8hpp_source.html#l00022">read_stream.hpp:22</a></div></div>
<div class="ttc" id="astructaltintegration_1_1VTB_html"><div class="ttname"><a href="structaltintegration_1_1VTB.html">altintegration::VTB</a></div><div class="ttdoc">Veriblock to Bitcoin publication, committed to Veriblock blockchain in containingBlock.</div><div class="ttdef"><b>Definition:</b> <a href="vtb_8hpp_source.html#l00028">vtb.hpp:28</a></div></div>
<div class="ttc" id="astructaltintegration_1_1VTB_html_a3d01efdef24e1705cfa0041cba456813"><div class="ttname"><a href="structaltintegration_1_1VTB.html#a3d01efdef24e1705cfa0041cba456813">altintegration::VTB::toVbkEncoding</a></div><div class="ttdeci">void toVbkEncoding(WriteStream &amp;stream) const</div><div class="ttdoc">Convert VTB to data stream using Vbk byte format.</div></div>
<div class="ttc" id="astructaltintegration_1_1VbkBlock_html"><div class="ttname"><a href="structaltintegration_1_1VbkBlock.html">altintegration::VbkBlock</a></div><div class="ttdoc">Veriblock block.</div><div class="ttdef"><b>Definition:</b> <a href="vbkblock_8hpp_source.html#l00032">vbkblock.hpp:32</a></div></div>
<div class="ttc" id="astructaltintegration_1_1VbkBlock_html_aa85426e112fc48c153616e3b0a79f009"><div class="ttname"><a href="structaltintegration_1_1VbkBlock.html#aa85426e112fc48c153616e3b0a79f009">altintegration::VbkBlock::toVbkEncoding</a></div><div class="ttdeci">std::vector&lt; uint8_t &gt; toVbkEncoding() const</div><div class="ttdoc">Convert VbkBlock to raw bytes data using VbkBlock byte format.</div></div>
</div><!-- fragment --><p><a class="el" href="integration_3_forkpoint.html#md_docs_families_btc_integration_3_forkpoint">Next Section</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<script>
    $(document).ready(function(){
        $('.line').each(function(){
            var t = $(this).html()
            if(t.startsWith("+")) {
                $(this).addClass('diff-plus')
                $(this).html(t.slice(1))
                $(this).prepend(
                    $('<div>+</div>')
                        .addClass('noselect')
                        .addClass('sign')
                )
            } else if (t.startsWith("-")) {
                $(this).addClass('diff-minus')
                $(this).html(t.slice(1))
                $(this).prepend(
                    $('<div>-</div>')
                        .addClass('noselect')
                        .addClass('sign')
                )
            }
        })
    });
</script>