<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>veriblock-pop-cpp: Testing of POP-enabled BTC fork</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="main.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">veriblock-pop-cpp
   </div>
   <div id="projectbrief">C++11 Libraries for leveraging VeriBlock Proof-Of-Proof blockchain technology.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('btctesting.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Testing of POP-enabled BTC fork </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md88">Summary</a></li>
<li class="level1"><a href="#autotoc_md89">Overview</a></li>
<li class="level1"><a href="#autotoc_md90">Unit tests</a></li>
<li class="level1"><a href="#autotoc_md91">BTC functional tests</a></li>
<li class="level1"><a href="#autotoc_md92">POP functional tests</a></li>
<li class="level1"><a href="#autotoc_md93">View APM get-operation</a></li>
<li class="level1"><a href="#autotoc_md94">Altchain BFI</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_docs_families_btc_testing"></a>​</p>
<p >​ </p>
<h1><a class="anchor" id="autotoc_md88"></a>
Summary</h1>
<p >To show that the pop-enabled altchain most likely works, once could screenshots (with supporting links) of: ​</p><ol type="1">
<li>All certification tests passing. <img src="certificationtests.png" alt="" class="inline" title="certification_tests"/>    </li>
<li>A single get-opereration from an APM. <img src="apmgetoperationscreenshot.png" alt="" class="inline" title="apm_getoperation_screenshot"/>     ​</li>
<li>A running network with multiple APM instances. For example, multiple pop tx with different reward addresses on the VBK explorer. If you run this API (with your unique altchain id), then it will return at least 2 rows: <a href="https://testnet.explore.veriblock.org/api/altchain/">https://testnet.explore.veriblock.org/api/altchain/</a>{altchain id}/validation/apm?withinNHours=4 <br  />
 <img src="apm_instances.png" alt="" class="inline" title="apm_instances"/>    </li>
<li>Altchain explorer screenshot showing (1) recent ATV and VTB, and (2) ABFI on a transaction. <img src="vbtcexplorerscreenshot_1.png" alt="" class="inline" title="vbtc_explorer_screenshot_1"/>     <img src="vbtcexplorerscreenshot_2.png" alt="" class="inline" title="vbtc_explorer_screenshot_2"/>    </li>
<li>Run ABFI and view successful health ping <div class="fragment"><div class="line">http://[ip_to_altchain_abfi]:4568/api/chains/blocks/last-finalized-btc</div>
</div><!-- fragment --> <img src="abfi_successful_result.png" alt="" class="inline" title="apm_instances"/>     Please see here for more details: <a class="el" href="integration_13_setup_abfi.html#md_docs_families_btc_integration_13_setup_abfi">Setup ABFI</a></li>
</ol>
<p >​ </p>
<h1><a class="anchor" id="autotoc_md89"></a>
Overview</h1>
<p >​ Here we describe which POP related tests should be added and should pass to be confident that POP security works fine. All tests can be separated to the following categories:</p><ul>
<li><code>unit tests</code></li>
<li><code>BTC functional tests</code></li>
<li><code>POP functional tests</code></li>
<li><code>View APM get-operation</code> ​ </li>
</ul>
<h1><a class="anchor" id="autotoc_md90"></a>
Unit tests</h1>
<p >​ First thing is to make sure that all original BTC tests pass and work well. ​ On the Unix sytem you can do it with the following command: </p><div class="fragment"><div class="line">make check</div>
</div><!-- fragment --><p> ​ Before starting the POP integration it is recommended to fix tests if some of them do not work properly. ​ Here is the full list of the POP unit tests:</p><ul>
<li><code>e2e_poptx_tests.cpp</code></li>
<li><code>pop_reward_tests.cpp</code></li>
<li><code>vbk_merkle_tests.cpp</code></li>
<li><code>block_validation_tests.cpp</code></li>
<li><code>rpc_service_tests.cpp</code></li>
<li><code>genesis_block_tests.cpp</code></li>
<li><code>forkresolution_tests.cpp</code> ​</li>
</ul>
<p >You can see the corresponding changes in the Makefile: <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/026fba4e80bc114c68c636e3c9cfc6af855c9c94/src/Makefile.test.include#L117">https://github.com/VeriBlock/vbk-ri-btc/blob/026fba4e80bc114c68c636e3c9cfc6af855c9c94/src/Makefile.test.include#L117</a> ​ These tests are available in the <code>vbk/tests/unit</code> directory. ​ </p><dl class="section note"><dt>Note</dt><dd>Unit tests should pass prior to running BTC and POP functional tests. ​ </dd></dl>
<h1><a class="anchor" id="autotoc_md91"></a>
BTC functional tests</h1>
<p >​ Original Bitcoin code has functional tests that reside in the <code>test/functional</code> directory. ​ <code>bitcoind</code> should be built prior to running functional tests. <code>VBITCOIND_PATH</code> environment variable should be set to the path to the <code>bitcoind</code> daemon: </p><div class="fragment"><div class="line">export VBITCOIND_PATH=&lt;path to the daemon (bitcoind)&gt;</div>
</div><!-- fragment --><p> ​ Tests are started with the following command: </p><div class="fragment"><div class="line">python test/functional/test_runner.py</div>
</div><!-- fragment --><p> ​ </p>
<h1><a class="anchor" id="autotoc_md92"></a>
POP functional tests</h1>
<p >​ These tests validate that all POP functionality works fine. All important parts of the POP security are covered by these tests. Therefore it is important to make sure that all tests pass before starting Mainnet or even Testnet. ​ VeriBlock Python framework should be installed to make these tests run. Follow the VeriBlock Python testing guide <a href="https://github.com/VeriBlock/alt-integration-cpp/blob/master/pypoptools/README.md">here</a>. ​ Now the following POP test runner can be copied to the source code: <a href="https://github.com/VeriBlock/vbk-ri-btc/blob/master/test/integration/test_runner.py">https://github.com/VeriBlock/vbk-ri-btc/blob/master/test/integration/test_runner.py</a> ​ A <code>node</code> which acts as an adaptor for <code>bitcoind</code> has been implemented. This adaptor able to <code>run</code>, <code>stop</code>, <code>restart</code> <code>bitcoind</code> and execute RPC functions: <a href="https://github.com/VeriBlock/alt-integration-cpp/blob/master/pypoptools/pypoptesting/altchain_node_adaptors/vbitcoind_node.py">https://github.com/VeriBlock/alt-integration-cpp/blob/master/pypoptools/pypoptesting/altchain_node_adaptors/vbitcoind_node.py</a> ​ For debugging purposes it is possible to run a single test from the test set: </p><div class="fragment"><div class="line">python test_runner.py NodeBasicSyncTest</div>
<div class="line">​</div>
</div><!-- fragment --><p> ​ The result of successfully passing tests should look like this: ​ </p><div class="fragment"><div class="line">TEST                  | STATUS    | DURATION</div>
<div class="line"> </div>
<div class="line">NodeBasicSyncTest     | ✓ Passed  | 90 s</div>
<div class="line">NodeConnectTest       | ✓ Passed  | 28 s</div>
<div class="line">NodeGenerateTest      | ✓ Passed  | 8 s</div>
<div class="line">NodePreflightTest     | ✓ Passed  | 15 s</div>
<div class="line">NodeRestartTest       | ✓ Passed  | 32 s</div>
<div class="line">NodeStartTest         | ✓ Passed  | 18 s</div>
<div class="line">NodeStopTest          | ✓ Passed  | 17 s</div>
<div class="line">PopActivateTest       | ✓ Passed  | 19 s</div>
<div class="line">PopE2ETest            | ✓ Passed  | 41 s</div>
<div class="line">PopForkResolutionTest | ✓ Passed  | 436 s</div>
<div class="line">PopInitTest           | ✓ Passed  | 98 s</div>
<div class="line">PopMempoolGetpopTest  | ✓ Passed  | 326 s</div>
<div class="line">PopMempoolReorgTest   | ✓ Passed  | 38 s</div>
<div class="line">PopMempoolSyncTest    | ✓ Passed  | 64 s</div>
<div class="line">PopParamsTest         | ✓ Passed  | 8 s</div>
<div class="line">PopSyncTest           | ✓ Passed  | 31 s</div>
<div class="line"> </div>
<div class="line">ALL                   | ✓ Passed  | 1269 s (accumulated) </div>
<div class="line">Runtime: 1273 s</div>
</div><!-- fragment --><p> ​ </p>
<h1><a class="anchor" id="autotoc_md93"></a>
View APM get-operation</h1>
<p >Run getoperation and view an e2e pop transaction. </p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>add a screenshot</dd></dl>
<p >​ </p>
<h1><a class="anchor" id="autotoc_md94"></a>
Altchain BFI</h1>
<p >The latest <a href="https://hub.docker.com/r/veriblock/altchain-bfi/tags?page=1&amp;ordering=last_updated">ABFI build</a> can be downloaded through docker </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<script>
    $(document).ready(function(){
        $('.line').each(function(){
            var t = $(this).html()
            if(t.startsWith("+")) {
                $(this).addClass('diff-plus')
                $(this).html(t.slice(1))
                $(this).prepend(
                    $('<div>+</div>')
                        .addClass('noselect')
                        .addClass('sign')
                )
            } else if (t.startsWith("-")) {
                $(this).addClass('diff-minus')
                $(this).html(t.slice(1))
                $(this).prepend(
                    $('<div>-</div>')
                        .addClass('noselect')
                        .addClass('sign')
                )
            }
        })
    });
</script>